<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600" font-family="'Segoe UI', Arial, Helvetica, sans-serif">
  <defs>
    <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
      <path d="M 50 0 L 0 0 0 50" fill="none" stroke="#E2E8F0" stroke-width="0.5" opacity="0.3"/>
    </pattern>
    <linearGradient id="h-builtin" x1="0" x2="1" y1="0" y2="0">
      <stop offset="0%" stop-color="#238636"/><stop offset="100%" stop-color="#238636" stop-opacity="0.75"/>
    </linearGradient>
    <linearGradient id="h-sql" x1="0" x2="1" y1="0" y2="0">
      <stop offset="0%" stop-color="#1f6feb"/><stop offset="100%" stop-color="#1f6feb" stop-opacity="0.75"/>
    </linearGradient>
    <linearGradient id="h-pandas" x1="0" x2="1" y1="0" y2="0">
      <stop offset="0%" stop-color="#d4920b"/><stop offset="100%" stop-color="#d4920b" stop-opacity="0.75"/>
    </linearGradient>
    <linearGradient id="h-arrowopt" x1="0" x2="1" y1="0" y2="0">
      <stop offset="0%" stop-color="#E25A1C"/><stop offset="100%" stop-color="#E25A1C" stop-opacity="0.75"/>
    </linearGradient>
    <linearGradient id="h-pickle" x1="0" x2="1" y1="0" y2="0">
      <stop offset="0%" stop-color="#D13913"/><stop offset="100%" stop-color="#D13913" stop-opacity="0.75"/>
    </linearGradient>
    <filter id="shadow">
      <feDropShadow dx="0" dy="1" stdDeviation="2" flood-opacity="0.08"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="900" height="600" fill="#FFFFFF"/>
  <rect x="0" y="0" width="900" height="4" fill="#E25A1C"/>

  <!-- Title -->
  <text x="450" y="40" font-size="22" fill="#1A202C" text-anchor="middle" font-weight="bold" letter-spacing="1">PySpark UDF Performance Hierarchy</text>
  <text x="450" y="62" font-size="13" fill="#718096" text-anchor="middle">Verified overhead at 50M rows (Spark 4.1.0) -- lower is faster</text>

  <!-- Hierarchy tiers -->
  <!-- Tier 1: JVM-native (green zone) -->
  <rect x="40" y="85" width="820" height="130" rx="8" fill="#F0FFF4" stroke="#C6F6D5" filter="url(#shadow)"/>
  <text x="60" y="108" font-size="11" fill="#276749" font-weight="bold" letter-spacing="1">JVM-NATIVE EXECUTION</text>

  <!-- Built-in -->
  <g transform="translate(60, 118)">
    <rect x="0" y="0" width="370" height="36" rx="6" fill="url(#h-builtin)"/>
    <text x="15" y="23" font-size="14" fill="#FFFFFF" font-weight="bold">Built-in functions</text>
    <text x="355" y="23" font-size="13" fill="#FFFFFF" text-anchor="end" font-weight="bold">1.0x</text>
    <text x="380" y="16" font-size="10" fill="#276749">Catalyst + Tungsten codegen</text>
    <text x="380" y="30" font-size="9" fill="#68D391">baseline</text>
  </g>

  <!-- SQL UDFs -->
  <g transform="translate(60, 162)">
    <rect x="0" y="0" width="370" height="36" rx="6" fill="url(#h-sql)"/>
    <text x="15" y="23" font-size="14" fill="#FFFFFF" font-weight="bold">SQL UDFs</text>
    <text x="355" y="23" font-size="13" fill="#FFFFFF" text-anchor="end" font-weight="bold">~1.0x</text>
    <text x="380" y="16" font-size="10" fill="#2B6CB0">CREATE FUNCTION -- inlined by Catalyst</text>
    <text x="380" y="30" font-size="9" fill="#63B3ED">no overhead (compiles to same plan)</text>
  </g>

  <!-- Tier 2: Vectorized Python (yellow zone) -->
  <rect x="40" y="230" width="820" height="90" rx="8" fill="#FFFFF0" stroke="#FEFCBF" filter="url(#shadow)"/>
  <text x="60" y="253" font-size="11" fill="#975A16" font-weight="bold" letter-spacing="1">VECTORIZED PYTHON (ARROW BATCHES)</text>

  <!-- Pandas UDFs -->
  <g transform="translate(60, 263)">
    <rect x="0" y="0" width="370" height="36" rx="6" fill="url(#h-pandas)"/>
    <text x="15" y="23" font-size="14" fill="#FFFFFF" font-weight="bold">Pandas UDFs</text>
    <text x="355" y="23" font-size="13" fill="#FFFFFF" text-anchor="end" font-weight="bold">~5-7x</text>
    <text x="380" y="16" font-size="10" fill="#975A16">Arrow batch transfer + Pandas conversion</text>
    <text x="380" y="30" font-size="9" fill="#D69E2E">flat overhead, amortized by vectorization</text>
  </g>

  <!-- Tier 3: Row-at-a-time Python (red zone) -->
  <rect x="40" y="335" width="820" height="145" rx="8" fill="#FFF5F5" stroke="#FED7D7" filter="url(#shadow)"/>
  <text x="60" y="358" font-size="11" fill="#9B2C2C" font-weight="bold" letter-spacing="1">ROW-AT-A-TIME PYTHON (PER-ROW SERDE)</text>

  <!-- Arrow-opt Python UDFs -->
  <g transform="translate(60, 368)">
    <rect x="0" y="0" width="370" height="36" rx="6" fill="url(#h-arrowopt)"/>
    <text x="15" y="23" font-size="14" fill="#FFFFFF" font-weight="bold">Arrow-opt Python @udf</text>
    <text x="355" y="23" font-size="13" fill="#FFFFFF" text-anchor="end" font-weight="bold">~37-45x</text>
    <text x="380" y="16" font-size="10" fill="#9C4221">Arrow transport, still row-at-a-time execution</text>
    <text x="380" y="30" font-size="9" fill="#FC8181">format change only, not execution model</text>
  </g>

  <!-- Pickle Python UDFs -->
  <g transform="translate(60, 418)">
    <rect x="0" y="0" width="370" height="36" rx="6" fill="url(#h-pickle)"/>
    <text x="15" y="23" font-size="14" fill="#FFFFFF" font-weight="bold">Pickle Python @udf</text>
    <text x="355" y="23" font-size="13" fill="#FFFFFF" text-anchor="end" font-weight="bold">~35-45x</text>
    <text x="380" y="16" font-size="10" fill="#9B2C2C">Pickle ser/de, row-at-a-time execution</text>
    <text x="380" y="30" font-size="9" fill="#FC8181">legacy default -- avoid at scale</text>
  </g>

  <!-- Key insight box -->
  <rect x="60" y="500" width="780" height="58" rx="8" fill="#EBF8FF" stroke="#BEE3F8"/>
  <text x="80" y="522" font-size="12" fill="#2B6CB0" font-weight="bold">Key finding:</text>
  <text x="175" y="522" font-size="12" fill="#2D3748">Arrow transport doesn't help @udf -- the bottleneck is per-row Python execution, not serialization format.</text>
  <text x="80" y="542" font-size="12" fill="#2D3748">Pandas UDFs plateau at ~5-7x because vectorized batch processing amortizes the JVM-to-Python transfer cost.</text>

  <!-- Scale indicator on right -->
  <g transform="translate(830, 120)">
    <line x1="0" y1="0" x2="0" y2="350" stroke="#CBD5E0" stroke-width="1.5"/>
    <polygon points="-5,0 5,0 0,-8" fill="#238636"/>
    <text x="8" y="5" font-size="9" fill="#238636">Faster</text>
    <polygon points="-5,350 5,350 0,358" fill="#D13913"/>
    <text x="8" y="355" font-size="9" fill="#D13913">Slower</text>
  </g>

  <!-- Footer -->
  <text x="450" y="580" font-size="10" fill="#A0AEC0" text-anchor="middle" font-style="italic">Measured on Spark 4.1.0, Python 3.12, local[2]. Arrow UDFs (@arrow_udf) excluded: codegen not supported in classic mode.</text>

  <rect x="0" y="596" width="900" height="4" fill="#E25A1C"/>
</svg>