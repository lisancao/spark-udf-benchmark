<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 960 580" font-family="'Segoe UI', Arial, Helvetica, sans-serif">
  <defs>
    <pattern id="hatching" width="10" height="10" patternUnits="userSpaceOnUse" patternTransform="rotate(45)">
      <line x1="0" y1="0" x2="0" y2="10" stroke="#CBD5E0" stroke-width="1.5"/>
    </pattern>
    <filter id="shadow">
      <feDropShadow dx="0" dy="1" stdDeviation="2" flood-opacity="0.06"/>
    </filter>
    <marker id="arrowDown" markerWidth="8" markerHeight="6" refX="4" refY="6" orient="auto">
      <polygon points="0 0, 8 0, 4 6" fill="#238636"/>
    </marker>
  </defs>

  <rect width="960" height="580" fill="#FFFFFF"/>
  <rect x="0" y="0" width="960" height="4" fill="#E25A1C"/>

  <!-- Title -->
  <text x="480" y="36" font-size="22" fill="#1A202C" text-anchor="middle" font-weight="bold" letter-spacing="1">Transport vs Execution Model</text>
  <text x="480" y="56" font-size="13" fill="#718096" text-anchor="middle">Two independent axes determine Python UDF performance -- only one of them matters</text>

  <!-- Column headers (transport axis) -->
  <text x="330" y="97" font-size="14" fill="#4A5568" text-anchor="middle" font-weight="bold">Pickle Transport</text>
  <text x="330" y="113" font-size="11" fill="#A0AEC0" text-anchor="middle">Python pickle serialization</text>
  <text x="570" y="97" font-size="14" fill="#4A5568" text-anchor="middle" font-weight="bold">Arrow Transport</text>
  <text x="570" y="113" font-size="11" fill="#A0AEC0" text-anchor="middle">Apache Arrow columnar format</text>

  <!-- Row headers (execution axis) -->
  <text x="195" y="188" font-size="12" fill="#4A5568" text-anchor="end" font-weight="bold">ROW-AT-A-TIME</text>
  <text x="195" y="204" font-size="10" fill="#A0AEC0" text-anchor="end">per-row Python calls</text>

  <text x="195" y="338" font-size="12" fill="#4A5568" text-anchor="end" font-weight="bold">VECTORIZED BATCH</text>
  <text x="195" y="354" font-size="10" fill="#A0AEC0" text-anchor="end">Pandas/NumPy/PyArrow operations</text>

  <!-- ═══════ Cell (1,1): Pickle x Row-at-a-time ═══════ -->
  <rect x="210" y="125" width="235" height="130" rx="8" fill="#FFF5F5" stroke="#FED7D7" filter="url(#shadow)"/>
  <text x="328" y="175" font-size="30" fill="#D13913" text-anchor="middle" font-weight="bold">~40x</text>
  <text x="328" y="198" font-size="13" fill="#9B2C2C" text-anchor="middle">@udf (default)</text>
  <text x="328" y="216" font-size="11" fill="#A0AEC0" text-anchor="middle">pickle serde, per-row exec</text>
  <text x="328" y="244" font-size="10" fill="#FC8181" text-anchor="middle">4.71s at 50M rows</text>

  <!-- ═══════ Cell (1,2): Arrow x Row-at-a-time ═══════ -->
  <rect x="455" y="125" width="235" height="130" rx="8" fill="#FFF5F5" stroke="#FED7D7" filter="url(#shadow)"/>
  <text x="573" y="175" font-size="30" fill="#D13913" text-anchor="middle" font-weight="bold">~40x</text>
  <text x="573" y="198" font-size="13" fill="#9B2C2C" text-anchor="middle">@udf + arrow config</text>
  <text x="573" y="216" font-size="11" fill="#A0AEC0" text-anchor="middle">arrow format, same exec model</text>
  <text x="573" y="244" font-size="10" fill="#FC8181" text-anchor="middle">4.81s at 50M rows</text>

  <!-- "equals" indicator between top cells -->
  <rect x="440" y="175" width="20" height="24" rx="4" fill="#FFFFFF"/>
  <text x="450" y="195" font-size="20" fill="#A0AEC0" text-anchor="middle">=</text>

  <!-- ═══════ Cell (2,1): Pickle x Vectorized -- doesn't exist ═══════ -->
  <rect x="210" y="275" width="235" height="130" rx="8" fill="url(#hatching)" stroke="#E2E8F0" filter="url(#shadow)"/>
  <text x="328" y="338" font-size="14" fill="#A0AEC0" text-anchor="middle" font-style="italic">not possible</text>
  <text x="328" y="358" font-size="11" fill="#CBD5E0" text-anchor="middle">pickle can't batch</text>

  <!-- ═══════ Cell (2,2): Arrow x Vectorized -- @pandas_udf & @arrow_udf ═══════ -->
  <rect x="455" y="275" width="235" height="130" rx="8" fill="#F0FFF4" stroke="#C6F6D5" filter="url(#shadow)"/>
  <text x="573" y="314" font-size="30" fill="#238636" text-anchor="middle" font-weight="bold">~5x</text>
  <text x="573" y="336" font-size="13" fill="#276749" text-anchor="middle">@pandas_udf  |  @arrow_udf</text>
  <text x="573" y="354" font-size="11" fill="#68D391" text-anchor="middle">arrow batches + vectorized ops</text>
  <text x="573" y="378" font-size="10" fill="#276749" text-anchor="middle">@pandas_udf: 0.77s at 50M</text>
  <text x="573" y="394" font-size="10" fill="#276749" text-anchor="middle">@arrow_udf: 0.37s at 10M (preliminary)</text>

  <!-- Vertical improvement arrow (right of matrix) -->
  <line x1="700" y1="190" x2="700" y2="335" stroke="#238636" stroke-width="2" marker-end="url(#arrowDown)"/>
  <text x="714" y="255" font-size="12" fill="#238636" font-weight="bold">6-8x</text>
  <text x="714" y="270" font-size="11" fill="#238636">faster</text>

  <!-- Horizontal "no difference" annotation below top row -->
  <line x1="328" y1="262" x2="573" y2="262" stroke="#A0AEC0" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="450" y="274" font-size="10" fill="#A0AEC0" text-anchor="middle">transport change: negligible</text>

  <!-- @udf(useArrow) floating annotation (far right) -->
  <rect x="745" y="200" width="190" height="85" rx="6" fill="#FFFFF0" stroke="#FEFCBF" filter="url(#shadow)"/>
  <text x="840" y="222" font-size="12" fill="#975A16" text-anchor="middle" font-weight="bold">@udf(useArrow)</text>
  <text x="840" y="248" font-size="22" fill="#E25A1C" text-anchor="middle" font-weight="bold">~6-17x</text>
  <text x="840" y="268" font-size="10" fill="#A0AEC0" text-anchor="middle">Arrow transport, per-row exec</text>
  <text x="840" y="280" font-size="10" fill="#A0AEC0" text-anchor="middle">sits between the two rows</text>
  <!-- Connector line from Arrow UDF box to matrix -->
  <line x1="745" y1="243" x2="700" y2="243" stroke="#FEFCBF" stroke-width="1.5" stroke-dasharray="4,3"/>

  <!-- Key insight box -->
  <rect x="50" y="425" width="860" height="70" rx="8" fill="#EBF8FF" stroke="#BEE3F8" filter="url(#shadow)"/>
  <text x="72" y="450" font-size="13" fill="#2B6CB0" font-weight="bold">Key insight:</text>
  <text x="168" y="450" font-size="13" fill="#2D3748">Transport format barely matters (39.7x vs 40.6x). Execution model is everything.</text>
  <text x="72" y="472" font-size="12" fill="#4A5568">Arrow batches only help when paired with vectorized execution (@pandas_udf). Changing transport alone changes nothing.</text>

  <!-- Footer -->
  <text x="480" y="530" font-size="10" fill="#A0AEC0" text-anchor="middle" font-style="italic">Overhead vs built-in functions. Measured on Spark 4.1.0, Python 3.12, Spark Connect local[*]. 50M rows, median of 3 runs.</text>

  <rect x="0" y="576" width="960" height="4" fill="#E25A1C"/>
</svg>