services:
  benchmark:
    build: .
    mem_limit: 48g
    environment:
      - SPARK_MASTER=local[*]
      - PYSPARK_PYTHON=python3
      - SPARK_DRIVER_MEMORY=32g
    volumes:
      - ./results:/opt/benchmark/results
    # Override CMD to run specific scale:
    #   docker compose run benchmark --rows 50000000
    #
    # Run tests:
    #   docker compose run benchmark pytest tests/ -v

  test:
    build: .
    mem_limit: 16g
    entrypoint: ["python3", "-m", "pytest"]
    command: ["tests/", "-v"]
    environment:
      - PYSPARK_PYTHON=python3
